## 11月9日 Web基础课

### 1.网络爬虫：requests与xpath的使用

Requests库的核心功能围绕“发送HTTP请求”与“处理响应”展开，这里我们主要介绍其两种方法：

1. requests.get()：获取资源
2. requests.post()：提交数据

分别对应于http协议的get请求与post请求。我们有些时候可以利用requests库代替burpsuite进行发包。我们先从一个简单的例子出发看看requests库的基本功能：以学校的sep网站为例：url=https://sep.ucas.ac.cn/ ， 我们使用requests库爬取一下该页面的信息：
```python
import requests

url = "https://sep.ucas.ac.cn"

response = requests.get(url).text

with open("sep_requests.html", "w", encoding="utf-8") as file:
    file.write(response)
```

很快就爬取到了sep登录页面的源码。可以看到我们sep的一个基本框架，但是非常简陋，这是因为我们很多图片与css设计没有爬取下来，我们可以利用xpath语法来实现。

xpath是一种用来解析html文件，用来进行标签定位的语法。Python的lxml库为我们实现了这个功能。我们以href标签作为一个示例：
```python
from lxml import etree
import re

tree = etree.HTML(response)
links = tree.xpath("//*[@href]")         #找到所有链接
for link in links:
    href = link.get("href")
    print(href)

links = tree.xpath("//link[@href]")          #找到link节点下的链接
for link in links:
    href = link.attrib["href"]
    print(href)

regex = re.compile(r'/.*(?:png|jpe?g|gif|bmp)', re.IGNORECASE)  #正则表达式，捕获组与非捕获组
image_links = regex.findall(response)
for img in image_links:
    print(img)
```

对于html的文本，利用xpath语法进行定位可以帮助我们快速找到想要查看的内容。正则表达式是另一种对于所有文本查找筛选的方法。

EX1：爬取国科大本科教育网的通知公告：https://bkjy.ucas.ac.cn/tzgg

我如何爬取所有的通知？

EX2：sep门户登录，以及内部各种网页的访问：https://sep.ucas.ac.cn

自动登录，ajax异步请求，重定向机制，cookie！

### 2. XSS攻击介绍
XSS攻击，也就是跨站脚本攻击，主要原理是将恶意的javascript脚本嵌入到某些位置，诱发恶意命令执行。它主要有三种类型：

1. 反射型XSS  (一次点击，一次执行，一般由不严格的参数过滤引起) 123.56.165.53:30001
```php
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>反射型XSS测试</title>
</head>
<body>
    <h1>反射型XSS测试页面</h1>
     <p>get参数为msg</p>
    <?php
    // 接收用户输入（未过滤）
    if (isset($_GET['msg'])) {
        $msg = $_GET['msg']; // 直接获取URL参数
        echo "<div class='output'>您输入的内容：$msg</div>"; // 未过滤直接输出
    }
    ?>
    <p>测试示例：</p>
    <p>基础弹窗：&lt;script&gt;alert('XSS')&lt;/script&gt;；</p>
    <p>图片onerror事件：&lt;img src="x" onerror="alert('XSS')"&gt;</p>
    <p>SVG标签：&lt;svg onload="alert('XSS')"&gt;；</p>
</body>
</html>
```


2. DOM型XSS 123.56.165.53:31003
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM XSS Test using document.write()</title>
</head>
<body>
    <h1>DOM-based XSS</h1>

    <label for="userInput">Enter XSS Payload:</label>
    <input type="text" id="userInput" placeholder="Enter XSS payload here">
    <button onclick="submitInput()">Submit</button>

    <h2>Your Input:</h2>
    <div id="output"></div>

    <script>
        function submitInput() {
            // 获取用户输入的内容
            var userInput = document.getElementById('userInput').value;

            // 使用 document.write() 插入用户输入
            document.write("<div>" + userInput + "</div>");   //html5的安全机制导致innerhtml不可用

            // 如果用户输入的是恶意的 JavaScript 代码，
            // 这段代码会被执行
        }
    </script>
</body>
</html>

```

3. 存储型XSS  (一次攻击，长期存在，服务端对用户的输入过滤不严格造成)123.56.165.53:31004

附件下载：[附件](./web_1109_source.zip)